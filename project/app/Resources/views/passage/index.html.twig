{% set _menu_active = 'passage' %}
{% extends 'base.html.twig' %}
{% block body %}

    {{ include('etablissement/choixForm.html.twig', {'form': formEtablissement}) }}

    <div class="row">
        <div class="col-xs-12">
            <h3>Liste des passages Ã  planifier <span class="badge">{{ passages | length }}</span></h3>
            <div class="form-horizontal">
                <div class="form-group">
                    <div class="col-xs-12">
                        <select mulitple="multiple" data-placeholder="Filtrer la liste en saisissant un techinicien, un code postal, ..." data-hamzastyle-container="#liste_passage" class="hamzastyle form-control select2"></select>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="col-xs-6">
                    <div id="liste_passage" class="list-group well" style="height: 650px; overflow: auto; position: relative;">
                        {% for passage in passages %}
                            {% if(passage.techniciens | length == 0) %}
                            {% else %}
                            <a data-words='{{ [passage.techniciens[0].identite, passage.etablissementInfos.adresse.codePostal, passage.etablissementInfos.adresse.commune, passage.etablissementInfos.type, passage.datePrevision | localizeddate('full', 'none'), passage.etablissementInfos.nom]|json_encode() }}' href="{{path('passage_etablissement', {'id': 'ETABLISSEMENT-'~passage.etablissementIdentifiant })}}" id="{{ passage.id }}" class="list-group-item hamzastyle-item">
                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="row">
                                            <div class="col-sm-9">
                                                <i class="mdi mdi-{{ passage.etablissementInfos.icon }} mdi-lg"></i>
                                                <strong>{{ passage.etablissementInfos.nom|capitalize }}</strong>
                                                <small>{{ passage.etablissementInfos.adresse.codePostal }} {{ passage.etablissementInfos.adresse.commune }}</small>
                                            </div>
                                            <div class="col-sm-3 text-right">
                                                {% for prestation in passage.prestations %}
                                                    {% if(prestation.wordToPicto) %}
                                                        <span class="step size-24" title="{{  prestation.nomToString }}" data-toggle="tooltip" >
                                                            <i class="mdi-{{prestation.wordToPicto}}">&nbsp;</i></span>
                                                    {%else%}
                                                        <span class="label label-xs label-primary">{{  prestation.nomToString }}</span>
                                                    {%endif%}
                                                {% endfor %}
                                            </div>
                                        </div>
                                        </div>
                                        {% if passage.etablissementInfos.telephoneFixe or passage.etablissementInfos.telephonePortable %}
                                            <div class="col-sm-12">
                                                <i class="mdi mdi-call mdi-lg"></i>
                                                <small>{{ passage.etablissementInfos.telephoneFixe }}</small>
                                                {% if passage.etablissementInfos.telephoneFixe and passage.etablissementInfos.telephonePortable %}
                                                    /
                                                {% endif %}
                                                <small>{{ passage.etablissementInfos.telephonePortable }}</small>
                                            </div>
                                        {% endif %}
                                    </div>
                                    <div class="row" style="margin-top:10px;">
                                        <div class="col-sm-5 text-left">
                                            <i class="mdi mdi-person mdi-lg"></i>
                                            <span class="label" style="background-color: {{ passage.techniciens[0].couleur }};color: {{ passage.techniciens[0].couleurText }};"><small>{{ passage.techniciens[0].identite }}</small></span>
                                        </div>
                                        <div class="col-sm-2 text-center">
                                            <i class="mdi mdi-schedule mdi-lg"></i>
                                            <small>01h</small>
                                        </div>
                                        <div class="col-sm-5 text-right">
                                            <i class="mdi mdi-date-range mdi-lg"></i>
                                            <small>{{ passage.datePrevision | localizeddate("medium", "none", null, null, "MMMM YYYY") | capitalize }}</small>
                                        </div>
                                    </div>
                                </a>
                      {% endif %}
                      {% endfor %}
                    </div>

                </div>
                <div class="col-xs-6">
                    <div id="map" class="well" style="width: 100%; height: 650px;" data-geojson="{{ geojson | json_encode(constant('JSON_HEX_QUOT')) }}"></div>
                    <pre class="hidden">{{ geojson | json_encode() }}</pre>
                </div>
            </div>
        </div>
    </div>
{% endblock %}
