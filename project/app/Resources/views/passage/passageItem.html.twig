{% set words = "" %}
{% set techColor = "" %}
{% set techBgColor = "" %}
{% set techIdentite = "" %}

{% if(passage.techniciens | length == 0) %}
    {% set words = ["sans technicien", passage.etablissementInfos.adresse.codePostal, passage.etablissementInfos.adresse.commune, passage.etablissementInfos.type, passage.datePrevision | localizeddate("medium", "none", null, null, "MMMM YYYY") | capitalize, passage.etablissementInfos.nom]|json_encode() %}
    {% set techColor = 'white' %}
    {% set techBgColor = 'black' %}
    {% set techIdentite = "sans technicien" %}
    {% set urlPlanif = path('calendarManuel') %}
{% else %}
    {% set words = [passage.techniciens[0].identite, passage.etablissementInfos.adresse.codePostal, passage.etablissementInfos.adresse.commune, passage.etablissementInfos.type, passage.datePrevision | localizeddate("medium", "none", null, null, "MMMM YYYY") | capitalize, passage.etablissementInfos.nom]|json_encode() %}
    {% set techColor = passage.techniciens[0].couleurText %}
    {% set techBgColor = passage.techniciens[0].couleur %}
    {% set techIdentite = passage.techniciens[0].identite %}
    {% set urlPlanif = path('calendar', {'passage' : passage.id,'technicien' : passage.techniciens[0].id, 'calendrier' : passage.datedebut|date('d-m-Y')}) %}
{% endif %}
<a data-words='{{ words }}' href="{{path('passage_etablissement', {'id': 'ETABLISSEMENT-'~passage.etablissementIdentifiant })}}" id="{{ passage.id }}" class="list-group-item hamzastyle-item">
    <div class="row">
        <div class="col-sm-12">
            <div class="row">
                <div class="col-sm-9">
                    <i class="mdi mdi-{{ passage.etablissementInfos.icon }} mdi-lg"></i>
                    <strong>{{ passage.etablissementInfos.nom|capitalize }}</strong>
                    <small>{{ passage.etablissementInfos.adresse.codePostal }} {{ passage.etablissementInfos.adresse.commune }}</small>
                </div>
                <div class="col-sm-3 text-right">
                    {% for prestation in passage.prestations %}
                        {% if(prestation.wordToPicto) %}
                            <span class="step size-24" title="{{  prestation.nomToString }}" data-toggle="tooltip" >
                                <i class="mdi-{{prestation.wordToPicto}}">&nbsp;</i></span>
                            {%else%}
                            <span class="label label-xs label-primary">{{  prestation.nomToString }}</span>
                        {%endif%}
                    {% endfor %}
                </div>
            </div>
        </div>
        {% if passage.etablissementInfos.telephoneFixe or passage.etablissementInfos.telephonePortable %}
            <div class="col-sm-12">
                <i class="mdi mdi-call mdi-lg"></i>
                <small>{{ passage.etablissementInfos.telephoneFixe }}</small>
                {% if passage.etablissementInfos.telephoneFixe and passage.etablissementInfos.telephonePortable %}
                    /
                {% endif %}
                <small>{{ passage.etablissementInfos.telephonePortable }}</small>
            </div>
        {% endif %}
    </div>
    <div class="row" style="margin-top:10px;">
        <div class="col-sm-5 text-left">
            <span class="label" style="background-color: {{ techBgColor }};color: {{ techColor }};"><small>{{ techIdentite }}</small></span>
        </div>
        <div class="col-sm-2 text-center">
            <i class="mdi mdi-schedule mdi-lg"></i>
            <small>01h</small>
        </div>
        <div class="col-sm-5 text-right">
            <div data-url="{{ urlPlanif }}" class="btn btn-link calendar_lien" >
                <i class="mdi mdi-date-range mdi-lg"></i>
                <small>{{ passage.datePrevision | localizeddate("medium", "none", null, null, "MMMM YYYY") | capitalize }}</small>
            </div>
        </div>
    </div>
</a>
