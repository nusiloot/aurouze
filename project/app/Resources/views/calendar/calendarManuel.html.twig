{% set _menu_active = 'calendar' %}
{% extends 'base.html.twig' %}
{% block body %}
<div class="row">
	<div id="fc-events" class="col-sm-12"></div>
    <div class="col-sm-12 hidden" id="retour_technicien_btn" ></div>
    <br/>
</div>
<ul class="nav nav-tabs nav-justified" role="tablist" style="margin-bottom: 15px; font-size: 13px;">
	{% if passage %}
		<li role="presentation"{% if not technicien %} class="active"{% endif %}><a href="{{ path('calendarManuel',{'passage': passage.passageIdentifiant(), 'calendrier': calendarTool.getDateDebutSemaine('Y-m-d')}) }}" role="tab" style="color: black;"><strong>Tous</strong></a></li>
	{% else %}
        <li role="presentation"{% if not technicien %} class="active"{% endif %}><a href="{{ path('calendarManuel',{'calendrier': calendarTool.getDateDebutSemaine('Y-m-d')}) }}" role="tab" style="color: black;"><strong>Tous</strong></a></li>
    {% endif %}
	{% set i=0 %}
	{% for tech in techniciens %}
    <li role="presentation"{% if tech.getIdentite() == technicien %} class="active"{% endif %}>
        {% if passage %}
        <a href="{{ path('calendar',{'passage': passage.passageIdentifiant(), 'technicien': tech.getIdentite(), 'calendrier': calendarTool.getDateDebutSemaine('Y-m-d')}) }}" role="tab" style="color: {{ tech.getCouleur() }};"><strong>{{ tech.getInituleCourt() }}</strong></a>
        {% else %}
        <a href="{{ path('calendar',{'technicien': tech.getIdentite(), 'calendrier': calendarTool.getDateDebutSemaine('Y-m-d')}) }}" role="tab" style="color: {{ tech.getCouleur() }};"><strong>{{ tech.getInituleCourt() }}</strong></a>
        {% endif %}
    </li>
    {% set i=loop.index %}
	{% endfor %}
</ul>
<div class="row">
	<div class="col-sm-12">
		<div class="fc fc-ltr fc-unthemed">
			<div class="fc-toolbar">
				<div class="fc-left">
					<button class="fc-prevButton-button fc-button fc-state-default fc-corner-left fc-corner-right" type="button"
					{% if passage %}
    				onclick="window.location.href='{{ path('calendarManuel',{'passage': passage.passageIdentifiant(), 'calendrier': calendarTool.getSemainePrecedente('Y-m-d')}) }}'" 
    				{% else %}
    				onclick="window.location.href='{{ path('calendarManuel',{'calendrier': calendarTool.getSemainePrecedente('Y-m-d')}) }}'" 
    				{% endif %}
					>
						<span class="fc-icon fc-icon-left-single-arrow"></span>
					</button>
					<h2>{% if calendarTool.getDateDebutSemaine('n') == calendarTool.getDateFinSemaine('n') %}{{ calendarTool.getDateDebutSemaine('j') }}{% else %}{{ calendarTool.getDateDebutSemaine('j') ~ " " ~ calendarTool.getShortLibelleMois(calendarTool.getDateDebutSemaine('n')) }}{% endif %} &mdash; {{ calendarTool.getDateFinSemaine('j') ~ " " ~ calendarTool.getShortLibelleMois(calendarTool.getDateFinSemaine('n')) ~ " " ~ calendarTool.getDateFinSemaine('Y') }}</h2>
					<button class="fc-nextButton-button fc-button fc-state-default fc-corner-left fc-corner-right" type="button"
					{% if passage %}
    				onclick="window.location.href='{{ path('calendarManuel',{'passage': passage.passageIdentifiant(), 'calendrier': calendarTool.getSemaineSuivante('Y-m-d')}) }}'"  
    				{% else %}
    				onclick="window.location.href='{{ path('calendarManuel',{'calendrier': calendarTool.getSemaineSuivante('Y-m-d')}) }}'"   
    				{% endif %}
					>
						<span class="fc-icon fc-icon-right-single-arrow"></span>
					</button>
				</div>
				<div class="fc-center"></div><div class="fc-clear"></div></div>
			<div class="fc-view-container">
				<div class="fc-view fc-agendaWeek-view fc-agenda-view">
					<table>
						<thead class="fc-head">
							<tr>
								<td class="fc-head-container fc-widget-header">
									<div class="fc-row fc-widget-header">
										<table>
											<thead>
												<tr>
													<th class="fc-axis fc-widget-header" style="width: 17px;"></th>
													{% for date, eventDate in eventsDates %}
													<th data-date="{{ date }}" class="fc-day-header fc-widget-header fc-mon">{{ calendarTool.getShortLibelleJour(date|date("N")) }} {{ date|date("j") }}/{{ date|date("n") }}</th>
													{% endfor %}
												</tr>
											</thead>
										</table>
									</div>
								</td>
							</tr>
						</thead>
						<tbody class="fc-body">
							<tr>
								<td class="fc-widget-content">
									<div class="fc-time-grid-container" style="height: 530px; overflow: hidden;">
										<div class="fc-time-grid">
											<div class="fc-bg">
												<table>
													<tbody>
														<tr>
															<td class="fc-axis fc-widget-content" style="width: 17px;"></td>
															{% for date, eventDate in eventsDates %}
															<td data-date="" class="fc-day fc-widget-content{% if date == calendarTool.getAujourdhui('Y-m-d') %} fc-today fc-state-highlight{% endif %}"></td>
															{% endfor %}
														</tr>
													</tbody>
												</table>
											</div>
											<div class="fc-slats">
												<table>
													<tbody>
														{% for i in 6..18 %}
															<tr data-time="{{ "%02d:00:00"|format(i) }}">
																<td class="fc-axis fc-time fc-widget-content" style="width: 17px;"><span>{{ "%02d"|format(i) }}</span></td>
																<td class="fc-widget-content"></td>
															</tr>
															<tr class="fc-minor" data-time="{{ "%02d:30:00"|format(i) }}">
																<td class="fc-axis fc-time fc-widget-content" style="width: 17px;"></td>
																<td class="fc-widget-content"></td>
															</tr>
													    {% endfor %}
													</tbody>
												</table>
											</div>
											<div class="fc-content-skeleton">
												<table>
													<tbody>
														<tr>
															<td style="width:17px" class="fc-axis"></td>
															{% for date, eventDate in eventsDates %}
															<td class="{{ date }}">
																<div class="fc-content-col">
																	<div class="fc-event-container">
																		{% set index = 0 %}
																		{% for technicien, events in eventDate %}
																			{% for event in events %}
																			<a style="
																				background-color: {{ event.backgroundColor }}; 
																				color: {{ event.textColor }}; 
																				z-index: {{ index }}; 
																				top: {{ event.coefStart * 22}}px; 
																				bottom: -{{ event.coefEnd * 22}}px; 
																				left: {{ ((100 / nbTechniciens) * index)|round(0, 'floor') }}%; 
																				width: {{ ((100 / nbTechniciens))|round(0, 'floor') -1 }}%;" 
																				class="fc-time-grid-event fc-v-event fc-event fc-start fc-end"
																				nb="{{ eventDate|keys|length }}">
																			</a>
																			{% endfor %}
																			{% set index = index + 1 %}
																		{% endfor %}
																	</div>
																</div>
															</td>
															{% endfor %}
														</tr>
													</tbody>
												</table>
											</div>
											<hr class="fc-divider fc-widget-header" style="display: block;">
										</div>
									</div>
								</td>
							</tr>
						</tbody>	
					</table>
				</div>
			</div>	
		</div>
	</div>
</div>	
{% endblock %}					
										
										
										
										
										
										